# ============================================================================
# KAFKA MIRRORMAKER 2 CONFIGURATION
# ============================================================================
# Multi-cluster replication for disaster recovery and geo-distribution
# ============================================================================

# ============================================================================
# CLUSTER ALIASES
# ============================================================================
clusters=source, target

# Source cluster configuration
source.bootstrap.servers=${SOURCE_KAFKA_BOOTSTRAP_SERVERS:-kafka01:9092,kafka02:9092,kafka03:9092}
source.security.protocol=PLAINTEXT

# Target cluster configuration (DR site)
target.bootstrap.servers=${TARGET_KAFKA_BOOTSTRAP_SERVERS:-dr-kafka01:9092,dr-kafka02:9092,dr-kafka03:9092}
target.security.protocol=PLAINTEXT

# ============================================================================
# REPLICATION FLOWS
# ============================================================================
# Enable source -> target replication
source->target.enabled=true

# Disable reverse replication (one-way only)
target->source.enabled=false

# ============================================================================
# TOPIC CONFIGURATION
# ============================================================================
# Topics to replicate (regex patterns)
source->target.topics=logs.*,metrics,events,alerts-stream

# Topics to exclude
source->target.topics.exclude=.*-internal,__.*,connect-.*

# Preserve topic partitions count
replication.policy.class=org.apache.kafka.connect.mirror.IdentityReplicationPolicy

# Topic naming
replication.policy.separator=.

# ============================================================================
# CONSUMER GROUP REPLICATION
# ============================================================================
# Sync consumer group offsets
sync.group.offsets.enabled=true
sync.group.offsets.interval.seconds=60

# Consumer groups to replicate
groups=logstash-consumer-group,connect-.*

# Exclude internal groups
groups.exclude=console-consumer.*,_.*

# Emit checkpoints for offset translation
emit.checkpoints.enabled=true
emit.checkpoints.interval.seconds=60

# Emit heartbeats for cluster health
emit.heartbeats.enabled=true
emit.heartbeats.interval.seconds=5

# ============================================================================
# REPLICATION SETTINGS
# ============================================================================
# Replication factor for mirrored topics on target
replication.factor=3

# Refresh topics interval
refresh.topics.enabled=true
refresh.topics.interval.seconds=600

# Refresh groups interval
refresh.groups.enabled=true
refresh.groups.interval.seconds=600

# ============================================================================
# PRODUCER SETTINGS (for target cluster)
# ============================================================================
target.producer.acks=all
target.producer.retries=2147483647
target.producer.max.block.ms=9223372036854775807
target.producer.batch.size=32768
target.producer.linger.ms=10
target.producer.compression.type=lz4

# ============================================================================
# CONSUMER SETTINGS (for source cluster)
# ============================================================================
source.consumer.auto.offset.reset=earliest
source.consumer.max.poll.records=1000
source.consumer.max.poll.interval.ms=300000
source.consumer.session.timeout.ms=60000

# ============================================================================
# CONNECTOR SETTINGS
# ============================================================================
# Number of tasks per connector
tasks.max=4

# Offset commit interval
offset.lag.max=100
offset.flush.interval.ms=60000

# ============================================================================
# MONITORING
# ============================================================================
# Metrics
metrics.reporters=

# ============================================================================
# SECURITY (uncomment when enabled)
# ============================================================================
# Source cluster security
# source.security.protocol=SASL_SSL
# source.sasl.mechanism=PLAIN
# source.sasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required username="mirror" password="mirror-secret";
# source.ssl.truststore.location=/var/ssl/private/kafka-client.truststore.jks
# source.ssl.truststore.password=kafka-secret

# Target cluster security
# target.security.protocol=SASL_SSL
# target.sasl.mechanism=PLAIN
# target.sasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required username="mirror" password="mirror-secret";
# target.ssl.truststore.location=/var/ssl/private/kafka-client.truststore.jks
# target.ssl.truststore.password=kafka-secret
